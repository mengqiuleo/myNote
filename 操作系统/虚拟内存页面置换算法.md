# 虚拟内存页面置换算法

[TOC]



## 前置知识

> 操作系统的功能包括对内存进行管理，内存空间紧张时，操作系统将内存中某些进程暂时换出外存，把外存中某些已具备运行条件的进程换入内存。

在操作系统的管理下，在用户看来似乎有一个比实际内存大得多的内存，这就是**虚拟内存**。比如一个游戏有16GB，而我们的内存只有4GB，但手机可以运行这个游戏，原因就在于操作系统会将游戏中重要的正在使用的进程放入内存，而其他放在外存。

**实现虚拟内存的关键在于**：操作系统需要根据某些指标来决定到底换出哪些页面(放入内存的进程会被成为页面)，所以就出现了页面置换算法。

> 页面置换算法就是来决定淘汰哪个页面

页面置换算法分类：

- 最佳置换算法（OPT）
- 先进先出置换算法（FIFO）
- 最近最久未使用置换算法（LRU）
- 时钟置换算法（CLOCK）
- 改进型的时钟置换算法



## 最佳置换算法(OPT)

![](E:\note\OS\内存\最佳置换.jpg)

**解释：**

- 首先按照访问次序，页面 7,0,1依次放入内存块中，并且打`√`表示是**缺页**
- 接下来要将页面2放入内存中，但内存块已满，要从0,1,7中选择一个进行**置换**，根据规则(淘汰的是未来最久不被使用的页面)，所以将内存块1中的页面7换出，将页面2换入到内存块2中
- 接下来访问页面0，在内存中
- 再向下访问页面3，**发生页面置换**，根据规则(淘汰的是未来最久不被使用的页面)，在以后内存块中的页面0,2首先会被访问到，然后页面1被访问，所以将页面1换出
- 按照上述规则继续向下



**缺页率：**

因为我们用对号标记了是否发生缺页，所以直接用 **标记对号的个数/总页数**



> 该算法无法实现，因为我们无法预置未来会访问那些页面





## 先进先出置换算法（FIFO）

![](E:\note\OS\内存\先进先出.jpg)

**先进先出置换算法就是淘汰最先进入内存的页面**



## 最近最久未使用置换算法（LRU）

![](E:\note\OS\内存\最近最久.jpg)

**解释**

- 按照访问顺序，依次将页面`1，8，7，2`放入内存
- 此时当访问到页面3时，**发生页面置换**，然后以页面3为起点(不包括3)，向前查找，依次查找到页面`8，1，2`，此时根据排除法，应该换出内存中的`页面7`，此时内存变成了`1，8，3，2`然后继续向下访问
- 向下依次访问页面8,2,1,3,1。然后访问页面7，此时**发生页面置换**，以页面7为起点(不包括7)，向前查找，依次查找页面`1,3,2`，此时根据排除法，应该换出内存中的`页面8`，此时内存变成了`1,7,3,2`。



> **方法：我们要向前查找，依次查找出现在内存块中的页面，用排除法，剩下的最后的那个页面就是最久未被使用的页面。**
>
> 注意要区分：最佳置换算法（向后找） 和 最近最久未使用置换算法（向前找）
>
> - 最佳置换算法是查找未来最长时间内将不会被访问到的页面
> - 最近最久未使用置换算法是查找之前访问的页面中谁是很久(最久)之前被访问的





## 时钟置换算法（CLOCK）

![](E:\note\OS\内存\时钟置换算法.jpg)



**一个🌰**

> 题目：假设系统为某进程分配了五个内存块，并考虑到有一下页面号引用串：1,3,4,2,5,6,3,4,7

**解释：**

1. 因为有五个内存块，所以前5个页面都是正常访问，然后将前5个页面链接成一个循环队列，并**设置访问位为1**

​	![](E:\note\OS\页面置换算法\1.jpg)



2. 接下来**访问页面6**，从页面1为起点，循环检查，**尝试找到一个访问位为0的页面，并且会将访问位为1的页面置为0，**在第一轮扫描中，所有页面都为1，所有将所有页面置为0

​	![](E:\note\OS\页面置换算法\2.jpg)

​	然后开启**第二轮扫描**，首先遇到**1号页面的访问位为0**，所以会选择**淘汰1号页**，6号页装入1号页，并且**6号页的访问位 置为1，	并将指针指向下一个页面，即页面3**

​	![](E:\note\OS\页面置换算法\3.jpg)



3. 接下来访问页面3,4，而页面3,4就在内存中，所以在访问时，**将页面3,4的访问位 置为1，此时指针仍然指向3号页**，

   ![](E:\note\OS\页面置换算法\4.jpg)



4. 接下来访问页面7，那么就从指针所在的位置依次向后扫描，找到第一个访问位为0的页面，并且扫描过的页面置为0，因为此时指针在3号页，将3号页的访问位置为0，然后向后访问，访问4号页，并将它的访问位置为0，然后扫描到2号页，发现它的访问位为0，所以置换2号页，并将它的访问位置为1，然后扫描指针指向下一个页面

​	![](E:\note\OS\页面置换算法\5.jpg)





## 改进型的时钟置换算法

![](E:\note\OS\内存\改进型.jpg)
