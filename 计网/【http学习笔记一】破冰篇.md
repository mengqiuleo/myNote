# 【http学习笔记一】

[TOC]





## 一、HTTP的前世今生

#### ① 创世纪

蒂姆·伯纳斯 - 李发表了一篇论文，提出了在互联网上构建超链接文档系统的构想。这篇论文中他确立了三项关键技术。
1. URI：即统一资源标识符，作为互联网上资源的唯一身份；
2. HTML：即超文本标记语言，描述超文本文档；
3. HTTP：即超文本传输协议，用来传输超文本。

在这一年，我们的英雄“HTTP”诞生了，从此开始了它伟大的征途。



#### ② HTTP/0.9

这一时期的 HTTP 被定义为 0.9 版，结构比较简单，为了便于服务器和客户端处理，它也
采用了纯文本格式。蒂姆·伯纳斯 - 李最初设想的系统里的文档都是只读的，所以只允许
用“GET”动作从服务器上获取 HTML 文档，并且在响应请求之后立即关闭连接，功能非
常有限。



#### ③ HTTP/1.0

HTTP/1.0 版本在 1996 年正式发布。
它在多方面增强了 0.9 版，形式上已经和我们现在的 HTTP 差别不大了，例如：

1. 增加了 HEAD、POST 等新方法；
2. 增加了响应状态码，标记可能的错误原因；
3. 引入了协议版本号概念；
4. 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；
5. 传输的数据不再仅限于文本。



#### ④ HTTP/1.1

HTTP/1.1 是对 HTTP/1.0 的小幅度修正。

HTTP/1.1 主要的变更点有：
1. 增加了 PUT、DELETE 等新的方法；
2. 增加了缓存管理和控制；
3. 明确了连接管理，允许持久连接；
4. 允许响应数据分块（chunked），利于传输大文件；
5. 强制要求 Host 头，让互联网主机托管成为可能。



#### ⑤ HTTP/2

HTTP/1.1 发布之后，整个互联网世界呈现出了爆发式的增长，度过了十多年的“快乐时
光”，更涌现出了 Facebook、Twitter、淘宝、京东等互联网新贵。
这期间也出现了一些对 HTTP 不满的意见，主要就是连接慢，无法跟上迅猛发展的互联
网，但 HTTP/1.1 标准一直“岿然不动”，无奈之下人们只好发明各式各样的“小花招”来
缓解这些问题，比如以前常见的切图、JS 合并等网页优化手段。

终于有一天，搜索巨头 Google 忍不住了，决定“揭竿而起”，就像马云说的“如果银行
不改变，我们就改变银行”。那么，它是怎么“造反”的呢？
Google 首先开发了自己的浏览器 Chrome，然后推出了新的 SPDY 协议，并在 Chrome
里应用于自家的服务器，如同十多年前的网景与微软一样，从实际的用户方来“倒
逼”HTTP 协议的变革，这也开启了第二次的“浏览器大战”。
历史再次重演，不过这次的胜利者是 Google，Chrome 目前的全球的占有率超过了
60%。“挟用户以号令天下”，Google 借此顺势把 SPDY 推上了标准的宝座，互联网标准
化组织以 SPDY 为基础开始制定新版本的 HTTP 协议，最终在 2015 年发布了 HTTP/2，
RFC 编号 7540。

HTTP/2 的制定充分考虑了现今互联网的现状：宽带、移动、不安全，在高度兼容
HTTP/1.1 的同时在性能改善方面做了很大努力，主要的特点有：
1. 二进制协议，不再是纯文本；
2. 可发起多个请求，废弃了 1.1 里的管道；
3. 使用专用算法压缩头部，减少数据传输量；
4. 允许服务器主动向客户端推送数据；
5. 增强了安全性，“事实上”要求加密通信。



#### ⑥ HTTP/3

在 HTTP/2 还处于草案之时，Google 又发明了一个新的协议，叫做 QUIC，而且还是相同
的“套路”，继续在 Chrome 和自家服务器里试验着“玩”，依托它的庞大用户量和数据
量，持续地推动 QUIC 协议成为互联网上的“既成事实”。

2018 年，互联网标准化组织 IETF 提议将“HTTP over QUIC”更名
为“HTTP/3”并获得批准，HTTP/3 正式进入了标准化制订阶段，也许两三年后就会正式
发布，到时候我们很可能会跳过 HTTP/2 直接进入 HTTP/3。





**总结：**

1. HTTP 协议始于三十年前蒂姆·伯纳斯 - 李的一篇论文；
2. HTTP/0.9 是个简单的文本协议，只能获取文本资源；
3. HTTP/1.0 确立了大部分现在使用的技术，但它不是正式标准；
4. HTTP/1.1 是目前互联网上使用最广泛的协议，功能也非常完善；
5. HTTP/2 基于 Google 的 SPDY 协议，注重性能改善，但还未普及；
6. HTTP/3 基于 Google 的 QUIC 协议，是将来的发展方向。



## 二、HTTP是什么？

HTTP 就是**超文本传输协议**，也就是HyperText Transfer Protocol。

先看一下 HTTP 的名字：“超文本传输协议”，它可以拆成三个部分，分别是：“超文
本”“传输”和“协议”。

<img src="E:\note\408\极客时间HTTP图片\HTTP.jpg" style="zoom:67%;" />



#### 1.协议

首先，HTTP 是一个协议。不过，协议又是什么呢？

第一点，协议必须要有两个或多个参与者，也就是“协”。

第二点，协议是对参与者的一种行为约定和规范，也就是“议”。

**HTTP 是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之**
**间交流通信的规范，以及相关的各种控制和错误处理方式。**



#### 2.传输

HTTP 字面里的第二部分：“传输”。

第一点，HTTP 协议是一个“双向协议”。

也就是说，有两个最基本的参与者 A 和 B，从 A 开始到 B 结束，数据在 A 和 B 之间双向
而不是单向流动。通常我们把先发起传输动作的 A 叫做请求方，把后接到传输的 B 叫做应
答方或者响应方。

第二点，数据虽然是在 A 和 B 之间传输，但并没有限制只有 A 和 B 这两个角色，允许中
间有“中转”或者“接力”。

这样，传输方式就从“A<===>B”，变成了“A<=>X<=>Y<=>Z<=>B”，A 到 B 的
传输过程中可以存在任意多个“中间人”，而这些中间人也都遵从 HTTP 协议，只要不打
扰基本的数据传输，就可以添加任意的额外功能，例如安全认证、数据压缩、编码转换等
等，优化整个传输过程。

**HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范。**



#### 3.超文本

HTTP 字面里的第三部分：“超文本”。

所谓“文本”（Text），就表示 HTTP 传输的不是 TCP/UDP 这些底层协议里被切分的杂
乱无章的二进制包（datagram），而是完整的、有意义的数据，可以被浏览器、服务器这
样的上层应用程序处理。
在互联网早期，“文本”只是简单的字符文字，但发展到现在，“文本”的涵义已经被大大
地扩展了，图片、音频、视频、甚至是压缩包，在 HTTP 眼里都可以算做是“文本”。
所谓“超文本”，就是“超越了普通文本的文本”，它是文字、图片、音频和视频等的混合
体，最关键的是含有“超链接”，能够从一个“超文本”跳跃到另一个“超文本”，形成复
杂的非线性、网状的结构关系。
对于“超文本”，我们最熟悉的就应该是 HTML 了，它本身只是纯文字文件，但内部用很
多标签定义了对图片、音频、视频等的链接，再经过浏览器的解释，呈现在我们面前的就是
一个含有多种视听信息的页面。

总结：

**HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范**



HTTP 不是一个孤立的协议。

在互联网世界里，HTTP 通常跑在 TCP/IP 协议栈之上，依靠 IP 协议实现寻址和路由、TCP
协议实现可靠数据传输、DNS 协议实现域名查找、SSL/TLS 协议实现安全通信。此外，还
有一些协议依赖于 HTTP，例如 WebSocket、HTTPDNS 等。这些协议相互交织，构成了
一个协议网，而 HTTP 则处于中心地位。



## 三、与HTTP相关的各种概念

#### 浏览器

浏览器的正式名字叫“Web Browser”，顾名思义，就是检索、查看互联网上网页资源的
应用程序，名字里的 Web，实际上指的就是“World Wide Web”，也就是万维网。

浏览器本质上是一个 HTTP 协议中的请求方，使用 HTTP 协议获取网络上的各种资源。当
然，为了让我们更好地检索查看网页，它还集成了很多额外的功能。
例如，HTML 排版引擎用来展示页面，JavaScript 引擎用来实现动态化效果，甚至还有开
发者工具用来调试网页，以及五花八门的各种插件和扩展。

在 HTTP 协议里，浏览器的角色被称为“User Agent”即“用户代理”，意思是作为访问
者的“代理”来发起 HTTP 请求。不过在不引起混淆的情况下，我们通常都简单地称之
为“客户端”。



#### Web 服务器

服务器，Web Server：在协议另一端的应答方（响应方）

当我们谈到“Web 服务器”时有两个层面的含义：硬件和软件。

**硬件**含义就是物理形式或“云”形式的机器，在大多数情况下它可能不是一台服务器，而是
利用反向代理、负载均衡等技术组成的庞大集群。但从外界看来，它仍然表现为一台机器，
但这个形象是“虚拟的”。

**软件**含义的 Web 服务器可能我们更为关心，它就是提供 Web 服务的应用程序，通常会运
行在硬件含义的服务器上。它利用强大的硬件能力响应海量的客户端 HTTP 请求，处理磁
盘上的网页、图片等静态文件，或者把请求转发给后面的 Tomcat、Node.js 等业务应用，
返回动态的信息。



比起层出不穷的各种 Web 浏览器，Web 服务器就要少很多了，一只手的手指头就可以数
得过来。
Apache 是老牌的服务器，到今天已经快 25 年了，功能相当完善，相关的资料很多，学习
门槛低，是许多创业者建站的入门产品。
Nginx 是 Web 服务器里的后起之秀，特点是高性能、高稳定，且易于扩展。自 2004 年推
出后就不断蚕食 Apache 的市场份额，在高流量的网站里更是不二之选。
此外，还有 Windows 上的 IIS、Java 的 Jetty/Tomcat 等，因为性能不是很高，所以在互
联网上应用得较少。



#### CDN

浏览器通常不会直接连到服务器，中间会经过“重重关卡”，其中的一个重要角色就叫做 CDN。

CDN，全称是“Content Delivery Network”，翻译过来就是“内容分发网络”。它应用了 HTTP 协议里的缓存和代理技术，代替源站响应客户端的请求。

CDN 有什么好处呢？
简单来说，它可以缓存源站的数据，让浏览器的请求不用“千里迢迢”地到达源站服务器，
直接在“半路”就可以获取响应。如果 CDN 的调度算法很优秀，更可以找到离用户最近的
节点，大幅度缩短响应时间。

CDN 也是现在互联网中的一项重要基础设施，除了基本的网络加速外，还提供负载均衡、
安全防护、边缘计算、跨运营商网络等功能，能够成倍地“放大”源站服务器的服务能力。



#### 爬虫

前面说到过浏览器，它是一种用户代理，代替我们访问互联网。
但 HTTP 协议并没有规定用户代理后面必须是“真正的人类”，它也完全可以是“机器
人”，这些“机器人”的正式名称就叫做“爬虫”（Crawler），实际上是一种可以自动访
问 Web 资源的应用程序。

爬虫是怎么来的呢？
绝大多数是由各大搜索引擎“放”出来的，抓取网页存入庞大的数据库，再建立关键字索
引，这样我们才能够在搜索引擎中快速地搜索到互联网角落里的页面。
爬虫也有不好的一面，它会过度消耗网络资源，占用服务器和带宽，影响网站对真实数据的分析，甚至导致敏感信息泄漏。所以，又出现了“反爬虫”技术，通过各种手段来限制爬虫。其中一项就是“君子协定”robots.txt，约定哪些该爬，哪些不该爬。
无论是“爬虫”还是“反爬虫”，用到的基本技术都是两个，一个是 HTTP，另一个就是HTML。



#### Web Service

它的名字与 Web Server 很像，但却是一个完全不同的东西。

Web Service 是一种由 W3C 定义的应用服务开发规范，使用 client-server 主从架构，通
常使用 WSDL 定义服务接口，使用 HTTP 协议传输 XML 或 SOAP 消息，也就是说，它是
一个基于 Web（HTTP）的服务架构技术，既可以运行在内网，也可以在适当保护后运行
在外网。
因为采用了 HTTP 协议传输数据，所以在 Web Service 架构里服务器和客户端可以采用不
同的操作系统或编程语言开发。例如服务器端用 Linux+Java，客户端用 Windows+C#，
具有跨平台跨语言的优点。



#### WAF

WAF是近几年比较“火”的一个词，意思是“网络应用防火墙”。与硬件“防火墙”类似，它是应用层面的“防火墙”，专门检测 HTTP 流量，是防护 Web 应用的安全技术。
WAF 通常位于 Web 服务器之前，可以阻止如 SQL 注入、跨站脚本等攻击，目前应用较多
的一个开源项目是 ModSecurity，它能够完全集成进 Apache 或 Nginx。



## 四、与HTTP相关的各种协议

#### TCP/IP

这个协议栈有四层，最上层是“应用层”，最下层是“链接层”，TCP 和 IP 则在中间：TCP 属于“传输层”，IP 属于“网际层”。

##### IP协议

**IP 协议**是“Internet Protocol”的缩写，主要目的是解决寻址和路由问题，以及如何在两点间传送数据包。IP 协议使用“IP 地址”的概念来定位互联网上的每一台计算机。可以对比一下现实中的电话系统，你拿着的手机相当于互联网上的计算机，而要打电话就必须接入电话网，由通信公司给你分配一个号码，这个号码就相当于 IP 地址。

现在我们使用的 IP 协议大多数是 v4 版，地址是四个用“.”分隔的数字，例如“192.168.0.1”，总共有 2^32，大约 42 亿个可以分配的地址。看上去好像很多，但互联网的快速发展让地址的分配管理很快就“捉襟见肘”。所以，就又出现了 v6 版，使用 8组“:”分隔的数字作为地址，容量扩大了很多，有 2^128 个，在未来的几十年里应该是足够用了。

##### TCP协议

TCP 协议是“Transmission Control Protocol”的缩写，意思是“传输控制协议”，它位于 IP 协议之上，基于 IP 协议提供可靠的、字节流形式的通信，是 HTTP 协议得以实现的基础。

“**可靠**”是指保证数据不丢失，“**字节流**”是指保证数据完整，所以在 TCP 协议的两端可以如同操作文件一样访问传输的数据，就像是读写在一个密闭的管道里“流动”的字节。



#### DNS

在 TCP/IP 协议中使用 IP 地址来标识计算机，数字形式的地址对于计算机来说是方便了，但对于人类来说却既难以记忆又难以输入。

**域名系统**：用有意义的名字来作为 IP 地址的等价替代。

在 DNS 中，“域名”（Domain Name）又称为“主机名”（Host），为了更好地标记不同国家或组织的主机，让名字更好记，所以被设计成了一个有层次的结构。

域名用“.”分隔成多个单词，级别从左到右逐级升高，最右边的被称为“顶级域名”。对于顶级域名，可能你随口就能说出几个，例如表示商业公司的“com”、表示教育机构的“edu”，表示国家的“cn”“uk”等，买火车票时的域名还记得吗？是“www.12306.cn”。

但想要使用 TCP/IP 协议来通信仍然要使用 IP 地址，所以需要把域名做一个转换，“映射”到它的真实 IP，这就是所谓的“**域名解析**”。

用打电话做个比喻，你想要打电话给小明，但不知道电话号码，就得在手机里的
号码簿里一项一项地找，直到找到小明那一条记录，然后才能查到号码。这里的“小明”就
相当于域名，而“电话号码”就相当于 IP 地址，这个查找的过程就是**域名解析**。

HTTP 协议中并没有明确要求必须使用 DNS，但实际上为了方便访问互联网上的 Web 服务器，通常都会使用 DNS 来定位或标记主机名，间接地把 DNS 与 HTTP 绑在了一起。



#### URI/URL

DNS 和 IP 地址只是标记了互联网上的主机，主机上有那么多文本、图片、页面，到底要找哪一个呢？

所以就出现了 URI（Uniform Resource Identifier），中文名称是 统一资源标识符，使用它就能够唯一地标记互联网上资源。

URI 另一个更常用的表现形式是 URL（Uniform Resource Locator）， 统一资源定位符，也就是我们俗称的“网址”，它实际上是 URI 的一个子集，不过因为这两者几乎是相同的，差异不大，所以通常不会做严格的区分。

举例：`http://nginx.org/en/download.html`

URI 主要有三个基本的部分构成：
1. 协议名：即访问该资源应当使用的协议，在这里是“http”；
2. 主机名：即互联网上主机的标记，可以是域名或 IP 地址，在这里是“nginx.org”；
3. 路径：即资源在主机上的位置，使用“/”分隔多级目录，在这里
是“/en/download.html”。



#### HTTPS

HTTPS ，它的全称是“HTTP over SSL/TLS”，也就是运行在 SSL/TLS 协议上的 HTTP。

这里的SSL/TLS，它是一个负责加密通信的安全协议，建立在 TCP/IP 之上，所以也是个可靠的传输协议，可以被用作 HTTP 的下层。

HTTPS 相当于“HTTP+SSL/TLS+TCP/IP”。

SSL 的全称是“Secure Socket Layer”，由网景公司发明，当发展到 3.0 时被标准化，改名为TLS，即“Transport Layer Security”，但由于历史的原因还是有很多人称之为SSL/TLS，或者直接简称为 SSL。

SSL 使用了许多密码学最先进的研究成果，综合了对称加密、非对称加密、摘要算法、数字
签名、数字证书等技术，能够在不安全的环境中为通信的双方创建出一个秘密的、安全的传
输通道，为 HTTP 套上一副坚固的盔甲。



#### 代理

代理（Proxy）是 HTTP 协议中请求方和应答方中间的一个环节，作为“中转站”，既可以
转发客户端的请求，也可以转发服务器的应答。

代理有很多的种类，常见的有：

1. 匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器；
2. 透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客
户端；
3. 正向代理：靠近客户端，代表客户端向服务器发送请求；
4. 反向代理：靠近服务器端，代表服务器响应客户端的请求；



CDN，实际上就是一种代理，它代替源站服务器响应客户端的请求，通常扮演着透明代理和反向代理的角色。

由于代理在传输过程中插入了一个“中间层”，所以可以在这个环节做很多有意思的事情，
比如：
1. 负载均衡：把访问请求均匀分散到多台机器，实现访问集群化；
2. 内容缓存：暂存上下行的数据，减轻后端的压力；
3. 安全防护：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器；
4. 数据处理：提供压缩、加密等额外的功能。





## 五、“四层”和“七层”

TCP/IP 协议是一个“有层次的协议栈”。

### TCP/IP 网络分层模型

<img src="E:\note\408\极客时间HTTP图片\四层.jpg" style="zoom:75%;" />

TCP/IP 协议总共有四层，就像搭积木一样，每一层需要下层的支撑，同时又支撑着上层，
任何一层被抽掉都可能会导致整个协议栈坍塌。

注意它的层次顺序是“从下往上”数的，所以第一层就是最下面的一层。

##### 链接层

第一层叫“**链接层**”（link layer），负责在以太网、WiFi 这样的底层网络上发送原始数据
包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有时候也叫 MAC
层。

##### 网际层

第二层叫“**网际层**”或者“网络互连层”（internet layer），IP 协议就处在这一层。因为
IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代
MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设
备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。

##### 传输层

第三层叫“**传输层”**（transport layer），这个层次协议的职责是保证数据在 IP 地址标记
的两点之间“可靠”地传输，是 TCP 协议工作的层次，另外还有它的一个“小伙伴”UDP。

TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢
失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不
保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连
续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。

##### 应用层

协议栈的第四层叫“**应用层**”（application layer），由于下面的三层把基础打得非常好，
所以在这一层就“百花齐放”了，有各种面向具体应用的协议。例如 Telnet、SSH、FTP、
SMTP 等等，当然还有我们的 HTTP。



MAC 层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位
是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有
什么本质的区分，可以统称为数据包。





### OSI 网络分层模型

OSI 模型分成了七层，部分层次与 TCP/IP 很像，从下到上分别是：

<img src="E:\note\408\极客时间HTTP图片\七层.jpg" style="zoom:80%;" />

1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网际层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。



对比：TCP/IP 是一个纯软件的栈，没有网络应有的最根基的电缆、网卡等物理设备的位置。而 OSI 则补足了这个缺失，在理论层面上描述网络更加完整。



### 两个分层模型的映射关系

<img src="E:\note\408\极客时间HTTP图片\映射.jpg" style="zoom:80%;" />

1. 第一层：物理层，TCP/IP 里无对应；
2. 第二层：数据链路层，对应 TCP/IP 的链接层；
3. 第三层：网络层，对应 TCP/IP 的网际层；
4. 第四层：传输层，对应 TCP/IP 的传输层；
5. 第五、六、七层：统一对应到 TCP/IP 的应用层。



所谓的“四层负载均衡”就是指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地
址、端口号等实现对后端服务器的负载均衡。

所谓的“七层负载均衡”就是指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文
里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。



有一个辨别四层和七层比较好的（但不是绝对的）小窍门，“**两个凡是**”：凡是由操作系统
负责处理的就是四层或四层以下，否则，凡是需要由应用程序（也就是你自己写代码）负责处理的就是七层。



## 六、域名理解

#### 域名的形式

域名是一个有层次的结构，是一串用“.”分隔的多个单词，最右边的被称为“顶级域名”，然后是“二级域名”，层级关系向左依次降低。

最左边的是主机名，通常用来表明主机的用途，比如“www”表示提供万维网服务、“mail”表示提供邮件服务，不过这也不是绝对的，名字的关键是要让我们容易记忆。

看一下极客时间的域名“time.geekbang.org”，这里的“org”就是顶级域
名，“geekbang”是二级域名，“time”则是主机名。使用这个域名，DNS 就会把它转
换成相应的 IP 地址，你就可以访问极客时间的网站了。



#### 域名的解析

就像 IP 地址必须转换成 MAC 地址才能访问主机一样，域名也必须要转换成 IP 地址，这个
过程就是“域名解析”。

DNS 的核心系统是一个三层的树状、分布式服务，基本对应域名的结构：
1. 根域名服务器（Root DNS Server）：管理顶级域名服务器，返回“com”“net”“cn”等顶级域名服务器的 IP 地址；
2. 顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如
com 顶级域名服务器可以返回 apple.com 域名服务器的 IP 地址；
3. 权威域名服务器（Authoritative DNS Server）：管理自己域名下主机的 IP 地址，比如
apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址。

<img src="E:\note\408\极客时间HTTP图片\DNS.jpg" style="zoom:80%;" />



在这里根域名服务器是关键，它必须是众所周知的，否则下面的各级服务器就无从谈起了。
目前全世界共有 13 组根域名服务器，又有数百台的镜像，保证一定能够被访问到。

例如，你要访问“www.apple.com”，就要进行下面的三次查询：
1. 访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；
2. 访问“com”顶级域名服务器，它再告诉你“apple.com”域名服务器的地址；
3. 最后访问“apple.com”域名服务器，就得到了“www.apple.com”的地址。



虽然核心的 DNS 系统遍布全球，服务能力很强也很稳定，但如果全世界的网民都往这个系
统里挤，即使不挤瘫痪了，访问速度也会很慢。
所以在核心 DNS 系统之外，还有两种手段用来减轻域名解析的压力，并且能够更快地获取
结果，基本思路就是“**缓存**”。

首先，许多大公司、网络运行商都会建立自己的 DNS 服务器，作为用户 DNS 查询的代
理，代替用户访问核心 DNS 系统。这些“野生”服务器被称为“非权威域名服务器”，可
以缓存之前的查询结果，如果已经有了记录，就无需再向根服务器发起查询，直接返回对应
的 IP 地址。
这些 DNS 服务器的数量要比核心系统的服务器多很多，而且大多部署在离用户很近的地
方。比较知名的 DNS 有 Google 的“8.8.8.8”，Microsoft 的“4.2.2.1”，还有CloudFlare 的“1.1.1.1”等等。
其次，操作系统里也会对 DNS 解析结果做缓存，如果你之前访问过“www.apple.com”，那么下一次在浏览器里再输入这个网址的时候就不会再跑到DNS 那里去问了，直接在操作系统里就可以拿到 IP 地址。

另外，操作系统里还有一个特殊的“主机映射”文件，通常是一个可编辑的文本，在 Linux
里是“/etc/hosts”，在 Windows 里
是“C:\WINDOWS\system32\drivers\etc\hosts”，如果操作系统在缓存里找不到 DNS记录，就会找这个文件。

有了上面的“野生”DNS 服务器、操作系统缓存和 hosts 文件后，很多域名解析的工作就都不用“跋山涉水”了，直接在本地或本机就能解决，不仅方便了用户，也减轻了各级DNS 服务器的压力，效率就大大提升了。



#### 域名的“新玩法”

##### 重定向

因为域名代替了 IP 地址，所以可以让对外服务的域名不变，而主机的 IP 地址任意变动。当主机有情况需要下线、迁移时，可以更改 DNS 记录，让域名指向其他的机器。
比如，你有一台“buy.tv”的服务器要临时停机维护，那你就可以通知 DNS 服务器：“我
这个 buy.tv 域名的地址变了啊，原先是 1.2.3.4，现在是 5.6.7.8，麻烦你改一下。”DNS
于是就修改内部的 IP 地址映射关系，之后再有访问 buy.tv 的请求就不走 1.2.3.4 这台主
机，改由 5.6.7.8 来处理，这样就可以保证业务服务不中断。





笔记均来自极客时间的课程学习：[透视HTTP协议](https://time.geekbang.org/column/intro/100029001)

