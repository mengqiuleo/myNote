[TOC]



## å†™åœ¨å‰é¢

è¿™é‡Œæ˜¯å°é£ä¾ PanğŸ¥³ï¼Œç«‹å¿—æˆä¸ºä¸€åä¼˜ç§€çš„å‰ç«¯ç¨‹åºåª›ï¼ï¼ï¼

æœ¬ç¯‡æ–‡ç« æ”¶å½•äºæˆ‘çš„ä¸“æ ï¼š[å‰ç«¯ç²¾è¿›ä¹‹è·¯](https://blog.csdn.net/weixin_52834435/category_11886356.html?spm=1001.2014.3001.5482)

åŒæ—¶æ”¶å½•äºæˆ‘çš„[github](https://github.com/mengqiuleo)å‰ç«¯ç¬”è®°ä»“åº“ä¸­ï¼ŒæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿star~

ğŸ‘‰[https://github.com/mengqiuleo/myNote](https://github.com/mengqiuleo/myNote)

<hr>

## æµ…æ‹·è´çš„åŸç†å’Œå®ç°

**æµ…æ‹·è´çš„å®šä¹‰**ï¼š

> è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¥æ¥å—ä½ è¦é‡æ–°å¤åˆ¶æˆ–å¼•ç”¨çš„å¯¹è±¡å€¼ã€‚å¦‚æœå¯¹è±¡å±æ€§æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ç»™æ–°å¯¹è±¡ï¼›ä½†å¦‚æœ**å±æ€§æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯å†…å­˜ä¸­çš„åœ°å€**ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªå†…å­˜ä¸­çš„åœ°å€ï¼Œè‚¯å®šä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚



### æ–¹æ³•ä¸€ï¼šobject.assign

**è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‹·è´çš„ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°æ˜¯æ‹·è´çš„æ¥æºå¯¹è±¡ï¼ˆä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ¥æºï¼‰**ã€‚

```
Object.assign(target, ...sources)
```

ä¸¾ä¾‹ï¼š

```js
let target = {};
let source = {
  a:{
    b:2
  }
};
Object.assign(target, source);
console.log(target);//{ a: { b: 2 } }
source.a.b = 10;
console.log(source);//{ a: { b: 10 } }
console.log(target);//{ a: { b: 10 } }
```



ä½¿ç”¨ object.assign æ–¹æ³•æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š

- å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ç»§æ‰¿å±æ€§ï¼›

- å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ä¸å¯æšä¸¾çš„å±æ€§ï¼›

- å¯ä»¥æ‹·è´ Symbol ç±»å‹çš„å±æ€§ã€‚

ä¸¾ä¾‹ï¼š

```js
let obj1 = { a:{ b:1 }, sym:Symbol(1)}; 

Object.defineProperty(obj1, 'innumerable' ,{

    value:'ä¸å¯æšä¸¾å±æ€§',

    enumerable:false

});

let obj2 = {};

Object.assign(obj2,obj1)

obj1.a.b = 2;

console.log('obj1',obj1);

console.log('obj2',obj2);

```

æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
![](./å›¾ç‰‡/ç»“æœ2.jpg)



### æ–¹æ³•äºŒï¼šæ‰©å±•è¿ç®—ç¬¦æ–¹å¼

æ‰©å±•è¿ç®—ç¬¦çš„è¯­æ³•ä¸ºï¼š`let cloneObj = { ...obj };`

æ‰©å±•è¿ç®—ç¬¦ å’Œ object.assign æœ‰åŒæ ·çš„ç¼ºé™·ï¼Œä¹Ÿå°±æ˜¯å®ç°çš„æµ…æ‹·è´çš„åŠŸèƒ½å·®ä¸å¤šï¼Œä½†æ˜¯å¦‚æœå±æ€§éƒ½æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦è¿›è¡Œæµ…æ‹·è´ä¼šæ›´åŠ æ–¹ä¾¿ã€‚

```js
/* å¯¹è±¡çš„æ‹·è´ */

let obj = {a:1,b:{c:1}}

let obj2 = {...obj}

obj.a = 2

console.log(obj)  //{a:2,b:{c:1}} 
console.log(obj2); //{a:1,b:{c:1}}

obj.b.c = 2

console.log(obj)  //{a:2,b:{c:2}} 
console.log(obj2); //{a:1,b:{c:2}}


/* æ•°ç»„çš„æ‹·è´ */

let arr =  [{a:1},{b:2},{c:3}];
let newArr = [...arr]; //è·Ÿarr.slice()æ˜¯ä¸€æ ·çš„æ•ˆæœ

console.log(newArr);//[ { a: 1 }, { b: 2 }, { c: 3 } ]

newArr[1].b = 10;

console.log(newArr);//[ { a: 1 }, { b: 10 }, { c: 3 } ]
console.log(arr);//[ { a: 1 }, { b: 10 }, { c: 3 } ]


```



### æ–¹æ³•ä¸‰ï¼šconcat æ‹·è´æ•°ç»„

```js
let arr = [{a:1},{b:2},{c:3}];

let newArr = arr.concat();

console.log(newArr);//[ { a: 1 }, { b: 2 }, { c: 3 } ]

newArr[1].b = 10;

console.log(newArr);//[ { a: 1 }, { b: 10 }, { c: 3 } ]
console.log(arr);//[ { a: 1 }, { b: 10 }, { c: 3 } ]
```



### æ–¹æ³•å››ï¼šslice æ‹·è´æ•°ç»„

slice æ–¹æ³•ä¹Ÿæ¯”è¾ƒæœ‰å±€é™æ€§ï¼Œå› ä¸ºå®ƒä»…ä»…é’ˆå¯¹æ•°ç»„ç±»å‹ã€‚slice æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡ç”±è¯¥æ–¹æ³•çš„å‰ä¸¤ä¸ªå‚æ•°æ¥å†³å®šåŸæ•°ç»„æˆªå–çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œæ˜¯ä¸ä¼šå½±å“å’Œæ”¹å˜åŸå§‹æ•°ç»„çš„ã€‚

slice çš„è¯­æ³•ä¸ºï¼š`arr.slice(begin, end);`

```js
let arr = [1, 2, {val: 4}];

let newArr = arr.slice();

newArr[2].val = 1000;

console.log(arr);  //[ 1, 2, { val: 1000 } ]

```



### æ‰‹å·¥å®ç°ä¸€ä¸ªæµ…æ‹·è´

1. å¯¹åŸºç¡€ç±»å‹åšä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸€ä¸ªæ‹·è´ï¼›
2. å¯¹å¼•ç”¨ç±»å‹å¼€è¾Ÿä¸€ä¸ªæ–°çš„å­˜å‚¨ï¼Œå¹¶ä¸”æ‹·è´ä¸€å±‚å¯¹è±¡å±æ€§ã€‚

```js
const shallowClone = (target) => {
    if (typeof target === 'object' && target !== null) {  //å¦‚æœæºå¯¹è±¡æ˜¯å¼•ç”¨æ•°æ®ç±»å‹

      const cloneTarget = Array.isArray(target) ? []: {}; 

      for (let prop in target) {  //éå†æºå¯¹è±¡ä¸­çš„å±æ€§
        if (target.hasOwnProperty(prop)) { 
            cloneTarget[prop] = target[prop]; 
        }  
      }  
      return cloneTarget; 

    } else {  //å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç›´æ¥è¿”å›
      return target;  
    }  
}

let obj = {a:2,b:{c:1}};

let obj1 = shallowClone(obj);

console.log(obj1);//{ a: 2, b: { c: 1 } }

obj1.b.c = 10;
obj1.a = 20;

console.log(obj);//{ a: 2, b: { c: 10 } }
console.log(obj1);//{ a: 20, b: { c: 10 } }

```



## æ·±æ‹·è´çš„åŸç†å’Œå®ç°

æµ…æ‹·è´åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¤åˆ¶äº†åŸæœ‰å¯¹è±¡çš„åŸºæœ¬ç±»å‹çš„å€¼ï¼Œè€Œå¼•ç”¨æ•°æ®ç±»å‹åªæ‹·è´äº†ä¸€å±‚å±æ€§ï¼Œå†æ·±å±‚çš„è¿˜æ˜¯æ— æ³•è¿›è¡Œæ‹·è´ã€‚æ·±æ‹·è´åˆ™ä¸åŒï¼Œå¯¹äºå¤æ‚å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå…¶åœ¨å †å†…å­˜ä¸­å®Œå…¨å¼€è¾Ÿäº†ä¸€å—å†…å­˜åœ°å€ï¼Œå¹¶å°†åŸæœ‰çš„å¯¹è±¡å®Œå…¨å¤åˆ¶è¿‡æ¥å­˜æ”¾ã€‚

è¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸äº’ç‹¬ç«‹ã€ä¸å—å½±å“çš„ï¼Œå½»åº•å®ç°äº†å†…å­˜ä¸Šçš„åˆ†ç¦»ã€‚

> å°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´åœ°æ‹·è´å‡ºæ¥ä¸€ä»½ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„ç©ºé—´å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„ä¿®æ”¹å¹¶ä¸ä¼šæ”¹å˜åŸå¯¹è±¡ï¼ŒäºŒè€…å®ç°çœŸæ­£çš„åˆ†ç¦»ã€‚





### æ–¹æ³•ä¸€ï¼šJSON.stringify å®ç°æ·±æ‹·è´

> æŠŠä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆä¸º JSON çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å¯¹è±¡é‡Œé¢çš„å†…å®¹è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œæœ€åå†ç”¨ JSON.parse() çš„æ–¹æ³•å°†JSON å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚

JSON çš„ è¯¦ç»†è§£é‡Šï¼šç‚¹å‡»è¿™é‡ŒğŸ‘‰ [JSON è¯¦è§£](https://blog.csdn.net/weixin_52834435/article/details/123437494?spm=1001.2014.3001.5501)

```js
let obj1 = { a:1, b:[1,2,3] }

let str = JSON.stringify(obj1);

let obj2 = JSON.parse(str);

console.log(obj2);   //{a:1,b:[1,2,3]} 

obj1.a = 2;

obj1.b.push(4);

console.log(obj1);   //{a:2,b:[1,2,3,4]}

console.log(obj2);   //{a:1,b:[1,2,3]}

```



ä½¿ç”¨ `JSON.stringify` å®ç°æ·±æ‹·è´çš„æ³¨æ„ç‚¹ï¼š

1. æ‹·è´çš„å¯¹è±¡çš„å€¼ä¸­å¦‚æœæœ‰å‡½æ•°ã€undefinedã€symbol è¿™å‡ ç§ç±»å‹ï¼Œç»è¿‡ JSON.stringify åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ä¸­è¿™ä¸ªé”®å€¼å¯¹ä¼šæ¶ˆå¤±ï¼›
2. æ‹·è´ Date å¼•ç”¨ç±»å‹ä¼šå˜æˆå­—ç¬¦ä¸²ï¼›
3. æ— æ³•æ‹·è´ä¸å¯æšä¸¾çš„å±æ€§ï¼›
4. æ— æ³•æ‹·è´å¯¹è±¡çš„åŸå‹é“¾ï¼›
5. æ‹·è´ RegExp å¼•ç”¨ç±»å‹ä¼šå˜æˆç©ºå¯¹è±¡ï¼›
6. å¯¹è±¡ä¸­å«æœ‰ NaNã€Infinity ä»¥åŠ -Infinityï¼ŒJSON åºåˆ—åŒ–çš„ç»“æœä¼šå˜æˆ nullï¼›
7. æ— æ³•æ‹·è´å¯¹è±¡çš„å¾ªç¯åº”ç”¨ï¼Œå³å¯¹è±¡æˆç¯ (obj[key] = obj)ã€‚



ä¸¾ä¾‹ï¼š

```js
function Obj() { 

    this.func = function () { alert(1) }; 
  
    this.obj = {a:1};
  
    this.arr = [1,2,3];
  
    this.und = undefined; 
  
    this.reg = /123/; 
  
    this.date = new Date(0); 
  
    this.NaN = NaN;
  
    this.infinity = Infinity;
  
    this.sym = Symbol(1);
  
} 
  
let obj1 = new Obj();//obj1ä¸ºåŸå¯¹è±¡
  
Object.defineProperty(obj1,'innumerable',{ 
  
    enumerable:false,
  
    value:'innumerable'
  
});
  
console.log('obj1',obj1);
  
let str = JSON.stringify(obj1);
  
let obj2 = JSON.parse(str);//obj2ä¸ºæ‹·è´åçš„å¯¹è±¡(å³ç›®æ ‡å¯¹è±¡)
  
console.log('obj2',obj2);
  
```

æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
![](./å›¾ç‰‡/ç»“æœ2.jpg)



## æ‰‹åŠ¨å®ç°æ·±æ‹·è´ 

### æœ€åŸºç¡€çš„æ·±æ‹·è´

```js
function clone(target) {
  if (typeof target === 'object') {
      let cloneTarget = {};
      for (const key in target) {
          cloneTarget[key] = clone(target[key]);// è¿™é‡Œå°±æ˜¯ä¸æµ…æ‹·è´çš„åŒºåˆ«ï¼Œè¿™é‡Œåˆ©ç”¨äº†é€’å½’ï¼Œå¦‚æœæŸä¸ªvalueå€¼æ˜¯å¯¹è±¡ä¼šç»§ç»­é€’å½’ä¸‹å»
      }
      return cloneTarget;
  } else {
      return target;
  }
};
```



### è€ƒè™‘æ•°ç»„

å¯¹æ•°ç»„è¿›è¡Œå…¼å®¹

```js
function clone(target) {
    if (typeof target === 'object') {
        let cloneTarget = Array.isArray(target) ? [] : {};
        for (const key in target) {
            cloneTarget[key] = clone(target[key]);
        }
        return cloneTarget;
    } else {
        return target;
    }
};

```



### å¾ªç¯å¼•ç”¨é—®é¢˜

å¯¹ä¸‹é¢çš„æ¡ˆä¾‹è¿›è¡Œæµ‹è¯•ï¼š

```js
const target = {
    field1: 1,
    field2: undefined,
    field3: {
        child: 'child'
    },
    field4: [2, 4, 8]
};
target.target = target; // å¾ªç¯å¼•ç”¨

const obj = clone(target);
console.log(obj);
```



![](./å›¾ç‰‡/æ ˆ.jpg)

å¯ä»¥å‘ç°ï¼šå› ä¸ºé€’å½’è¿›å…¥æ­»å¾ªç¯å¯¼è‡´æ ˆå†…å­˜æº¢å‡ºäº†ã€‚

åŸå› å°±æ˜¯ä¸Šé¢çš„å¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œå³å¯¹è±¡çš„å±æ€§é—´æ¥æˆ–ç›´æ¥çš„å¼•ç”¨äº†è‡ªèº«çš„æƒ…å†µï¼š

> è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é¢å¤–å¼€è¾Ÿä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ¥å­˜å‚¨å½“å‰å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„å¯¹åº”å…³ç³»ï¼Œå½“éœ€è¦æ‹·è´å½“å‰å¯¹è±¡æ—¶ï¼Œå…ˆå»å­˜å‚¨ç©ºé—´ä¸­æ‰¾ï¼Œæœ‰æ²¡æœ‰æ‹·è´è¿‡è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ç»§ç»­æ‹·è´ï¼Œè¿™æ ·å°±å·§å¦™åŒ–è§£çš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚

è¿™ä¸ªå­˜å‚¨ç©ºé—´ï¼Œéœ€è¦å¯ä»¥å­˜å‚¨`key-value`å½¢å¼çš„æ•°æ®ï¼Œä¸”`key`å¯ä»¥æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©`Map`è¿™ç§æ•°æ®ç»“æ„ï¼š

- æ£€æŸ¥`map`ä¸­æœ‰æ— å…‹éš†è¿‡çš„å¯¹è±¡
- æœ‰ - ç›´æ¥è¿”å›
- æ²¡æœ‰ - å°†å½“å‰å¯¹è±¡ä½œä¸º`key`ï¼Œå…‹éš†å¯¹è±¡ä½œä¸º`value`è¿›è¡Œå­˜å‚¨
- ç»§ç»­å…‹éš†

```js
function clone(target, map = new Map()) {//å› ä¸ºæ˜¯é€’å½’ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ç§æ˜ å°„å…³ç³»ç»§ç»­å‘ä¸‹ä¼ é€’ï¼Œæ‰€ä»¥æ”¾åœ¨å‚æ•°åˆ—è¡¨ä¸­
    if (typeof target === 'object') {
        let cloneTarget = Array.isArray(target) ? [] : {};
        if (map.get(target)) { //getæ–¹æ³•æ‹¿åˆ°ä¼ å…¥çš„keyå€¼çš„å¯¹åº”valueå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¡¨æ˜è¿™ä¸ªå¯¹è±¡å·²ç»è¢«æ‹·è´è¿‡äº†
            return map.get(target);//è¿”å›å·²ç»æ‹·è´äº†çš„å¯¹è±¡å³å¯
        }
        map.set(target, cloneTarget);//ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬è¦ä¿å­˜æºå¯¹è±¡å’Œå…‹éš†åçš„å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»
        for (const key in target) {
            cloneTarget[key] = clone(target[key], map);
        }
        return cloneTarget;
    } else {
        return target;
    }
};
```



### ä½¿ç”¨WeakMap

> WeakSetä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ WeakSet å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**å¦‚æœå…¶ä»–å¯¹è±¡éƒ½ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä¸è€ƒè™‘è¯¥å¯¹è±¡è¿˜å­˜åœ¨äº WeakSet ä¹‹ä¸­**ã€‚ è¿™æ˜¯å› ä¸ºåƒåœ¾å›æ”¶æœºåˆ¶æ ¹æ®å¯¹è±¡çš„å¯è¾¾æ€§ï¼ˆreachabilityï¼‰æ¥åˆ¤æ–­å›æ”¶ï¼Œå¦‚æœå¯¹è±¡è¿˜èƒ½è¢«è®¿é—®åˆ°ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šé‡Šæ”¾è¿™å—å†…å­˜ã€‚ç»“æŸä½¿ç”¨è¯¥å€¼ä¹‹åï¼Œæœ‰æ—¶ä¼šå¿˜è®°å–æ¶ˆå¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ï¼Œè¿›è€Œå¯èƒ½ä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚WeakSet é‡Œé¢çš„å¼•ç”¨ï¼Œéƒ½ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼ŒWeakSet é€‚åˆä¸´æ—¶å­˜æ”¾ä¸€ç»„å¯¹è±¡ï¼Œä»¥åŠå­˜æ”¾è·Ÿå¯¹è±¡ç»‘å®šçš„ä¿¡æ¯ã€‚åªè¦è¿™äº›å¯¹è±¡åœ¨å¤–éƒ¨æ¶ˆå¤±ï¼Œå®ƒåœ¨ WeakSet é‡Œé¢çš„å¼•ç”¨å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚ ç”±äºä¸Šé¢è¿™ä¸ªç‰¹ç‚¹ï¼ŒWeakSet çš„æˆå‘˜æ˜¯ä¸é€‚åˆå¼•ç”¨çš„ï¼Œå› ä¸ºå®ƒä¼šéšæ—¶æ¶ˆå¤±ã€‚å¦å¤–ï¼Œç”±äº WeakSet å†…éƒ¨æœ‰å¤šå°‘ä¸ªæˆå‘˜ï¼Œå–å†³äºåƒåœ¾å›æ”¶æœºåˆ¶æœ‰æ²¡æœ‰è¿è¡Œï¼Œè¿è¡Œå‰åå¾ˆå¯èƒ½æˆå‘˜ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œåƒåœ¾å›æ”¶æœºåˆ¶ä½•æ—¶è¿è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ ES6 è§„å®š WeakSet ä¸å¯éå†ã€‚ è¿™äº›ç‰¹ç‚¹åŒæ ·é€‚ç”¨äºæœ¬ç« åé¢è¦ä»‹ç»çš„ WeakMap ç»“æ„ã€‚-- [é˜®ä¸€å³°](https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2F)



**ç”¨demoæ¥è§£é‡Šå¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨**

```js
// å¯¹äºå¼ºå¼•ç”¨
const myMap = new Map()
let my = {
    name: "ljc",
    sex: "ç”·"
}
myMap.set(my, 'info');
console.log(myMap);
```

![](./å›¾ç‰‡/å¼º.jpg)

```js
// å¯¹äºå¼±å¼•ç”¨
const myMap = new WeakMap()
let my = {
    name: "ljc",
    sex: "ç”·"
}
myMap.set(my, 'info');
console.log(myMap);
```

![](./å›¾ç‰‡/å¼±.jpg)

> `WeakMap` ä¿æŒäº†å¯¹é”®åæ‰€å¼•ç”¨çš„å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸å°†è¯¥å¼•ç”¨è€ƒè™‘åœ¨å†…ã€‚åªè¦æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å…¶ä»–å¼•ç”¨éƒ½è¢«æ¸…é™¤ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼Œ`WeakMap` é‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨ã€‚



è€Œå¯¹äºè¿™é‡Œçš„å®ç°æ·±æ‹·è´ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æºå¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç”¨weakMapæ¥è®°å½•è¿™ä¸ªæºå¯¹è±¡æ˜¯å¦è¢«æ‹·è´äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘ä»¬çš„weakmapå®ä¾‹ä¸­ï¼Œæºå¯¹è±¡æ˜¯ä½œä¸ºkeyå€¼å­˜åœ¨ï¼Œå½“å®Œæˆæ‹·è´åï¼Œå¦‚æœè¿™ä¸ªæºå¯¹è±¡ä¸å†è¢«éœ€è¦ä¸”æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚å³ä½¿æˆ‘ä»¬ç°åœ¨è¿˜å­˜åœ¨ä½¿ç”¨weakmapå¯¹æºå¯¹è±¡è¿›è¡Œå¼•ç”¨ã€‚

```js
function clone(target, map = new WeakMap()) {//å› ä¸ºæ˜¯é€’å½’ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ç§æ˜ å°„å…³ç³»ç»§ç»­å‘ä¸‹ä¼ é€’ï¼Œæ‰€ä»¥æ”¾åœ¨å‚æ•°åˆ—è¡¨ä¸­
    if (typeof target === 'object') {
        let cloneTarget = Array.isArray(target) ? [] : {};
        if (map.get(target)) { //getæ–¹æ³•æ‹¿åˆ°ä¼ å…¥çš„keyå€¼çš„å¯¹åº”valueå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¡¨æ˜è¿™ä¸ªå¯¹è±¡å·²ç»è¢«æ‹·è´è¿‡äº†
            return map.get(target);//è¿”å›å·²ç»æ‹·è´äº†çš„å¯¹è±¡å³å¯
        }
        map.set(target, cloneTarget);//ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬è¦ä¿å­˜æºå¯¹è±¡å’Œå…‹éš†åçš„å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»
        for (const key in target) {
            cloneTarget[key] = clone(target[key], map);
        }
        return cloneTarget;
    } else {
        return target;
    }
};
```



### ä½¿ç”¨Reflect.ownKeys()æ–¹æ³•ï¼Œå¹¶å¯¹symbolç±»å‹æ‹·è´

Reflectæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

- å®ƒä¸»è¦æä¾›äº†å¾ˆå¤šæ“ä½œJavaScriptå¯¹è±¡çš„æ–¹æ³•ï¼Œæœ‰ç‚¹åƒObjectä¸­æ“ä½œå¯¹è±¡çš„æ–¹æ³•ï¼›
  - æ¯”å¦‚ Reflect.getPrototypeOf(target) ç±»ä¼¼äº Object.getPrototypeOf()ï¼›
  - æ¯”å¦‚ Reflect.defineProperty(target, propertyKey, attributes) ç±»ä¼¼äºObject.defineProperty() ï¼›
- å¦‚æœæˆ‘ä»¬æœ‰Objectå¯ä»¥åšè¿™äº›æ“ä½œï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦æœ‰Reflectè¿™æ ·çš„æ–°å¢å¯¹è±¡å‘¢ï¼Ÿ
  - è¿™æ˜¯å› ä¸ºåœ¨æ—©æœŸçš„ECMAè§„èŒƒä¸­æ²¡æœ‰è€ƒè™‘åˆ°è¿™ç§å¯¹å¯¹è±¡æœ¬èº«çš„æ“ä½œå¦‚ä½•è®¾è®¡ä¼šæ›´åŠ è§„èŒƒï¼Œæ‰€ä»¥å°†è¿™äº›APIæ”¾åˆ°äº†Objectä¸Šé¢ï¼›
  - ä½†æ˜¯Objectä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¿™äº›æ“ä½œå®é™…ä¸Šæ”¾åˆ°å®ƒèº«ä¸Šå¹¶ä¸åˆé€‚ï¼›
  - å¦å¤–è¿˜åŒ…å«ä¸€äº›ç±»ä¼¼äºinã€deleteæ“ä½œç¬¦ï¼Œè®©JSçœ‹èµ·æ¥æ˜¯ä¼šæœ‰ä¸€äº›å¥‡æ€ªçš„ï¼›
  - æ‰€ä»¥åœ¨ES6ä¸­æ–°å¢äº†Reflectï¼Œè®©æˆ‘ä»¬è¿™äº›æ“ä½œéƒ½é›†ä¸­åˆ°äº†Reflectå¯¹è±¡ä¸Šï¼›
    

> Reflect å¯¹è±¡çš„æ–¹æ³•å’Œobjectä¸€ä¸€å¯¹åº”çš„ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†ä¸ Object å¯¹è±¡çš„åŒåæ–¹æ³•çš„ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ã€‚
>
> `Reflect.ownKeys()`æ–¹æ³•å¯ä»¥è¿”å›æ‰€æœ‰ç±»å‹çš„é”®åï¼ŒåŒ…æ‹¬å¸¸è§„é”®åå’Œ **Symbol é”®å**ã€‚

```js
function clone(target, map = new WeakMap()) {//å› ä¸ºæ˜¯é€’å½’ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ç§æ˜ å°„å…³ç³»ç»§ç»­å‘ä¸‹ä¼ é€’ï¼Œæ‰€ä»¥æ”¾åœ¨å‚æ•°åˆ—è¡¨ä¸­
  if (typeof target === 'object') {
      let cloneTarget = Array.isArray(target) ? [] : {};
      if (map.get(target)) { //getæ–¹æ³•æ‹¿åˆ°ä¼ å…¥çš„keyå€¼çš„å¯¹åº”valueå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¡¨æ˜è¿™ä¸ªå¯¹è±¡å·²ç»è¢«æ‹·è´è¿‡äº†
          return map.get(target);//è¿”å›å·²ç»æ‹·è´äº†çš„å¯¹è±¡å³å¯
      }
      map.set(target, cloneTarget);//ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬è¦ä¿å­˜æºå¯¹è±¡å’Œå…‹éš†åçš„å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»
      Reflect.ownKeys(target).forEach(key => {
        cloneTarget[key] = clone(target[key], map);
      })
      return cloneTarget;
  } else {
      return target;
  }
};
```



æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```js
const target = {
  field1: 1,
  field2: undefined,
  field3: {
      child: 'child'
  },
  field4: [2, 4, 8],
  [Symbol('1')]: 1,//symbolç±»å‹
};
target.target = target; // å¾ªç¯å¼•ç”¨

const obj = clone(target);
console.log(obj);

/*
<ref *1> {
  field1: 1,
  field2: undefined,
  field3: { child: 'child' },
  field4: [ 2, 4, 8 ],
  target: [Circular *1],
  [Symbol(1)]: 1
}
*/
```





**å‚è€ƒæ–‡ç« **

[æµ…æ Map å’Œ WeakMap åŒºåˆ«ä»¥åŠä½¿ç”¨åœºæ™¯](https://juejin.cn/post/6993101968545677319#heading-29)

[å¦‚ä½•å†™å‡ºä¸€ä¸ªæƒŠè‰³é¢è¯•å®˜çš„æ·±æ‹·è´?](https://juejin.cn/post/6844903929705136141#heading-6)