[TOC]



## å†™åœ¨å‰é¢

è¿™é‡Œæ˜¯å°é£ä¾ PanğŸ¥³ï¼Œç«‹å¿—æˆä¸ºä¸€åä¼˜ç§€çš„å‰ç«¯ç¨‹åºåª›ï¼ï¼ï¼

æœ¬ç¯‡æ–‡ç« æ”¶å½•äºæˆ‘çš„ä¸“æ ï¼š[å‰ç«¯ç²¾è¿›ä¹‹è·¯](https://blog.csdn.net/weixin_52834435/category_11886356.html?spm=1001.2014.3001.5482)

åŒæ—¶æ”¶å½•äºæˆ‘çš„[github](https://github.com/mengqiuleo)å‰ç«¯ç¬”è®°ä»“åº“ä¸­ï¼ŒæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿star~

ğŸ‘‰[https://github.com/mengqiuleo/myNote](https://github.com/mengqiuleo/myNote)

<hr>

åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¼‚æ­¥çš„ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šcallbackã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»ç¬¬äºŒç§ï¼š**promise** 

åœ¨è¿™é‡Œå¹¶ä¸ä¼šä»‹ç»promiseçš„åŸºç¡€è¯­æ³•ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œè®°å½•ä¸€äº›promiseä»¥å‰æ²¡æœ‰æ¶‰åŠåˆ°çš„é—®é¢˜

å‰ç½®æ–‡ç« ï¼š

[ã€JSå¼‚æ­¥ã€‘Promiseå…¥é—¨ï¼ˆä¸€ï¼‰](https://blog.csdn.net/weixin_52834435/article/details/123927178)

[ã€JSå¼‚æ­¥ã€‘PromiseAPIï¼ˆäºŒï¼‰](https://blog.csdn.net/weixin_52834435/article/details/124422513)

[ã€promiseã€‘æ³¨æ„ç‚¹](https://blog.csdn.net/weixin_52834435/article/details/124595729)

[ã€Promiseã€‘ä»£ç è¾“å‡ºé¢è¯•é¢˜](https://blog.csdn.net/weixin_52834435/article/details/124594392)



## åŸºç¡€è¯­æ³•ç»†èŠ‚

### new Promiseçš„å¿«æ·æ–¹å¼

æ¯”å¦‚ `Promise.resolve(42);` å¯ä»¥è®¤ä¸ºæ˜¯ä»¥ä¸‹ä»£ç çš„è¯­æ³•ç³–ã€‚

```javascript
new Promise(function(resolve){
    resolve(42);
});
```

åœ¨è¿™æ®µä»£ç ä¸­çš„ `resolve(42);` ä¼šè®©è¿™ä¸ªpromiseå¯¹è±¡ç«‹å³è¿›å…¥ç¡®å®šï¼ˆå³resolvedï¼‰çŠ¶æ€ï¼Œå¹¶å°† `42` ä¼ é€’ç»™åé¢thené‡Œæ‰€æŒ‡å®šçš„ `onFulfilled` å‡½æ•°ã€‚

æ–¹æ³• `Promise.resolve(value);` çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢é‚£æ ·æ¥ç€å¯¹å…¶è¿”å›å€¼è¿›è¡Œ `.then` è°ƒç”¨ã€‚

```javascript
Promise.resolve(42).then(function(value){
    console.log(value);
});
```



### Thenable

`thenable`å¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚

```javascript
let thenable = {
  then: function(resolve, reject) {
    resolve(42);
  }
};
```

`Promise.resolve()`æ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ`thenable`å¯¹è±¡çš„`then()`æ–¹æ³•ã€‚

```javascript
let thenable = {
  then: function(resolve, reject) {
    resolve(42);
  }
};

let p1 = Promise.resolve(thenable);
p1.then(function (value) {
  console.log(value);  // 42
});
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`thenable`å¯¹è±¡çš„`then()`æ–¹æ³•æ‰§è¡Œåï¼Œå¯¹è±¡`p1`çš„çŠ¶æ€å°±å˜ä¸º`resolved`ï¼Œä»è€Œç«‹å³æ‰§è¡Œæœ€åé‚£ä¸ª`then()`æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡º42ã€‚



## then or catch?

`Promise.prototype.catch()`æ–¹æ³•æ˜¯`.then(null, rejection)`æˆ–`.then(undefined, rejection)`çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚

Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª`catch`è¯­å¥æ•è·ã€‚

```javascript
getJSON('/post/1.json').then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯
});
```

ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª Promise å¯¹è±¡ï¼šä¸€ä¸ªç”±`getJSON()`äº§ç”Ÿï¼Œä¸¤ä¸ªç”±`then()`äº§ç”Ÿã€‚å®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ï¼Œéƒ½ä¼šè¢«æœ€åä¸€ä¸ª`catch()`æ•è·ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œä¸è¦åœ¨`then()`æ–¹æ³•é‡Œé¢å®šä¹‰ Reject çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³`then`çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œæ€»æ˜¯ä½¿ç”¨`catch`æ–¹æ³•ã€‚

```javascript
// bad
promise
  .then(function(data) {
    // success
  }, function(err) {
    // error
  });

// good
promise
  .then(function(data) { //cb
    // success
  })
  .catch(function(err) {
    // error
  });
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒç§å†™æ³•è¦å¥½äºç¬¬ä¸€ç§å†™æ³•ï¼Œç†ç”±æ˜¯ç¬¬äºŒç§å†™æ³•å¯ä»¥æ•è·å‰é¢`then`æ–¹æ³•æ‰§è¡Œä¸­çš„é”™è¯¯ï¼Œä¹Ÿæ›´æ¥è¿‘åŒæ­¥çš„å†™æ³•ï¼ˆ`try/catch`ï¼‰ã€‚å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨`catch()`æ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨`then()`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

è·Ÿä¼ ç»Ÿçš„`try/catch`ä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨`catch()`æ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromise å¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ã€‚

```javascript
const someAsyncThing = function() {
  return new Promise(function(resolve, reject) {
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜
    resolve(x + 2);
  });
};

someAsyncThing().then(function() {
  console.log('everything is great');
});

setTimeout(() => { console.log(123) }, 2000);
// Uncaught (in promise) ReferenceError: x is not defined
// 123
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`someAsyncThing()`å‡½æ•°äº§ç”Ÿçš„ Promise å¯¹è±¡ï¼Œå†…éƒ¨æœ‰è¯­æ³•é”™è¯¯ã€‚æµè§ˆå™¨è¿è¡Œåˆ°è¿™ä¸€è¡Œï¼Œä¼šæ‰“å°å‡ºé”™è¯¯æç¤º`ReferenceError: x is not defined`ï¼Œä½†æ˜¯ä¸ä¼šé€€å‡ºè¿›ç¨‹ã€ç»ˆæ­¢è„šæœ¬æ‰§è¡Œï¼Œ2 ç§’ä¹‹åè¿˜æ˜¯ä¼šè¾“å‡º`123`ã€‚è¿™å°±æ˜¯è¯´ï¼ŒPromise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šå½±å“åˆ° Promise å¤–éƒ¨çš„ä»£ç ï¼Œé€šä¿—çš„è¯´æ³•å°±æ˜¯â€œPromise ä¼šåƒæ‰é”™è¯¯â€ã€‚

å†çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```javascript
const promise = new Promise(function (resolve, reject) {
  resolve('ok');
  setTimeout(function () { throw new Error('test') }, 0)
});
promise.then(function (value) { console.log(value) });
// ok
// Uncaught Error: test
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise æŒ‡å®šåœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€å†æŠ›å‡ºé”™è¯¯ã€‚åˆ°äº†é‚£ä¸ªæ—¶å€™ï¼ŒPromise çš„è¿è¡Œå·²ç»ç»“æŸäº†ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯æ˜¯åœ¨ Promise å‡½æ•°ä½“å¤–æŠ›å‡ºçš„ï¼Œä¼šå†’æ³¡åˆ°æœ€å¤–å±‚ï¼Œæˆäº†æœªæ•è·çš„é”™è¯¯ã€‚

ä¸€èˆ¬æ€»æ˜¯å»ºè®®ï¼ŒPromise å¯¹è±¡åé¢è¦è·Ÿ`catch()`æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å¤„ç† Promise å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯ã€‚`catch()`æ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨`then()`æ–¹æ³•ã€‚



## ä½¿ç”¨rejectè€Œä¸æ˜¯throw

ä¸ºä»€ä¹ˆåœ¨æƒ³å°†promiseå¯¹è±¡çš„çŠ¶æ€è®¾ç½®ä¸ºRejectedçš„æ—¶å€™åº”è¯¥ä½¿ç”¨ `reject` è€Œä¸æ˜¯ `throw` å‘¢ï¼Ÿ

é¦–å…ˆæ˜¯å› ä¸ºæˆ‘ä»¬å¾ˆéš¾åŒºåˆ† `throw` æ˜¯æˆ‘ä»¬ä¸»åŠ¨æŠ›å‡ºæ¥çš„ï¼Œè¿˜æ˜¯å› ä¸ºçœŸæ­£çš„å…¶å®ƒ **å¼‚å¸¸** å¯¼è‡´çš„ã€‚

æ¯”å¦‚åœ¨ä½¿ç”¨Chromeæµè§ˆå™¨çš„æ—¶å€™ï¼ŒChromeçš„å¼€å‘è€…å·¥å…·æä¾›äº†åœ¨ç¨‹åºå‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™è‡ªåŠ¨åœ¨è°ƒè¯•å™¨ä¸­breakçš„åŠŸèƒ½ã€‚

å½“æˆ‘ä»¬å¼€å¯è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œåœ¨æ‰§è¡Œåˆ°ä¸‹é¢ä»£ç ä¸­çš„ `throw` æ—¶å°±ä¼šè§¦å‘è°ƒè¯•å™¨çš„breakè¡Œä¸ºï¼ˆæ‰“æ–­ç‚¹ï¼‰ã€‚

```javascript
var promise = new Promise(function(resolve, reject){
    throw new Error("message");
});
```

æœ¬æ¥è¿™æ˜¯å’Œè°ƒè¯•æ²¡æœ‰å…³ç³»çš„åœ°æ–¹ï¼Œä¹Ÿå› ä¸ºåœ¨Promiseä¸­çš„ `throw` è¯­å¥è¢«breakäº†ï¼Œè¿™ä¹Ÿä¸¥é‡çš„å½±å“äº†æµè§ˆå™¨æä¾›çš„æ­¤åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ã€‚



## promiseçš„å±€é™æ€§

### å¼‚æ­¥å›è°ƒä¸­æŠ›é”™catchæ•æ‰ä¸åˆ°

é¦–å…ˆæˆ‘ä»¬çœ‹åœ¨Promiseå¯¹è±¡çš„å¤„ç†å™¨å‡½æ•°ä¸­ç›´æ¥æŠ›å‡ºé”™è¯¯

```js
const p = new Promise((resolve, reject)=>{
  throw new Error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯')
});
p.catch((error)=>{ console.log(error) });
```

æŒ‰ç…§ä¸Šè¿°å†…å®¹æ¥çœ‹ï¼Œåœ¨Promiseå¯¹è±¡çš„å¤„ç†å™¨å‡½æ•°ä¸­ç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œ`catch`æ˜¯å¯ä»¥æ•æ‰åˆ°çš„

åœ¨ä¸‹é¢ä»£ç ï¼Œåœ¨Promiseå¯¹è±¡çš„å¤„ç†å™¨å‡½æ•°ä¸­æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æŠ›é”™

```js
const p = new Promise((resolve, reject)=>{
  setTimeout(()=>{ throw new Error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯') }, 0)
});
p.catch((error)=>{ console.log(error) });
```

è¿™ç§æƒ…å†µ`catch`æ˜¯æ•æ‰ä¸åˆ°çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…ˆæƒ³åçœ‹ï¼Œå†åšä¸éš¾

**åŸå› **

JS äº‹ä»¶å¾ªç¯åˆ—è¡¨æœ‰å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ä¹‹åˆ†ï¼ŒsetTimeOutæ˜¯å®ä»»åŠ¡ï¼Œ promiseæ˜¯å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œé¡ºåºä¸åŒ

é‚£ä¹ˆè¿™æ®µä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š

1. ä»£ç æ‰§è¡Œæ ˆè¿›å…¥promise è§¦å‘setTimeOutï¼ŒsetTimeOutå›è°ƒå‡½æ•°å…¥å®ä»»åŠ¡é˜Ÿåˆ—
2. ä»£ç æ‰§è¡Œpromiseçš„catchæ–¹æ³•ï¼Œå…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ­¤æ—¶setTimeOutå›è°ƒè¿˜æ²¡æœ‰æ‰§è¡Œ
3. æ‰§è¡Œæ ˆæ£€æŸ¥å‘ç°å½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå®ä»»åŠ¡é˜Ÿåˆ—
4. æ‰§è¡Œ`throw new Error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯')` æ­¤æ—¶è¿™ä¸ªå¼‚å¸¸å…¶å®æ˜¯åœ¨promiseå¤–éƒ¨æŠ›å‡ºçš„

**è§£å†³**

ä½¿ç”¨`try catch`æ•è·å¼‚å¸¸ä¸»åŠ¨è§¦å‘`reject`

```js
const p = new Promise((resolve, reject)=>{
  setTimeout(()=>{ 
    try{
       throw new Error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯') 
    }catch(e){
       reject(e)
    }
 }, 0)
});
p.catch((error)=>{ console.log(error) });
```

### é”™è¯¯è¢«åƒæ‰

é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ï¼Œä»€ä¹ˆæ˜¯é”™è¯¯è¢«åƒæ‰ï¼Œæ˜¯æŒ‡é”™è¯¯ä¿¡æ¯ä¸è¢«æ‰“å°å—ï¼Ÿ

å¹¶ä¸æ˜¯ï¼Œä¸¾ä¸ªä¾‹å­ï¼š

```js
throw new Error('error');
console.log(233333);
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸º throw error çš„ç¼˜æ•…ï¼Œä»£ç è¢«é˜»æ–­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šæ‰“å° 233333ï¼Œå†ä¸¾ä¸ªä¾‹å­ï¼š

```js
const promise = new Promise(null);
console.log(233333);
```

ä»¥ä¸Šä»£ç ä¾ç„¶ä¼šè¢«é˜»æ–­æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé€šè¿‡æ— æ•ˆçš„æ–¹å¼ä½¿ç”¨ Promiseï¼Œå¹¶ä¸”å‡ºç°äº†ä¸€ä¸ªé”™è¯¯é˜»ç¢äº†æ­£å¸¸ Promise çš„æ„é€ ï¼Œç»“æœä¼šå¾—åˆ°ä¸€ä¸ªç«‹åˆ»è·‘å‡ºçš„å¼‚å¸¸ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¢«æ‹’ç»çš„ Promiseã€‚

ç„¶è€Œå†ä¸¾ä¸ªä¾‹å­ï¼š

```js
let promise = new Promise(() => {
    throw new Error('error')
});
console.log(2333333);
```

è¿™æ¬¡ä¼šæ­£å¸¸çš„æ‰“å° `233333`ï¼Œè¯´æ˜ Promise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šå½±å“åˆ° Promise å¤–éƒ¨çš„ä»£ç ï¼Œè€Œè¿™ç§æƒ…å†µæˆ‘ä»¬å°±é€šå¸¸ç§°ä¸º â€œåƒæ‰é”™è¯¯â€ã€‚

å…¶å®è¿™å¹¶ä¸æ˜¯ Promise ç‹¬æœ‰çš„å±€é™æ€§ï¼Œtry..catch ä¹Ÿæ˜¯è¿™æ ·ï¼ŒåŒæ ·ä¼šæ•è·ä¸€ä¸ªå¼‚å¸¸å¹¶ç®€å•çš„åƒæ‰é”™è¯¯ã€‚

è€Œæ­£æ˜¯å› ä¸ºé”™è¯¯è¢«åƒæ‰ï¼ŒPromise é“¾ä¸­çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«å¿½ç•¥æ‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šä¸€èˆ¬æ¨èåœ¨ Promise é“¾çš„æœ€åæ·»åŠ ä¸€ä¸ª catch å‡½æ•°ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªæ²¡æœ‰é”™è¯¯å¤„ç†å‡½æ•°çš„ Promise é“¾ï¼Œä»»ä½•é”™è¯¯éƒ½ä¼šåœ¨é“¾ä¸­è¢«ä¼ æ’­ä¸‹å»ï¼Œç›´åˆ°ä½ æ³¨å†Œäº†é”™è¯¯å¤„ç†å‡½æ•°ã€‚

### å•ä¸€å€¼

Promise åªèƒ½æœ‰ä¸€ä¸ªå®Œæˆå€¼æˆ–ä¸€ä¸ªæ‹’ç»åŸå› ï¼Œç„¶è€Œåœ¨çœŸå®ä½¿ç”¨çš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦ä¼ é€’å¤šä¸ªå€¼ï¼Œä¸€èˆ¬åšæ³•éƒ½æ˜¯æ„é€ ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œç„¶åå†ä¼ é€’ï¼Œthen ä¸­è·å¾—è¿™ä¸ªå€¼åï¼Œåˆä¼šè¿›è¡Œå–å€¼èµ‹å€¼çš„æ“ä½œï¼Œæ¯æ¬¡å°è£…å’Œè§£å°éƒ½æ— ç–‘è®©ä»£ç å˜å¾—ç¬¨é‡ã€‚

è¯´çœŸçš„ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•ï¼Œå»ºè®®æ˜¯ä½¿ç”¨ ES6 çš„è§£æ„èµ‹å€¼ï¼š

```js
Promise.all([Promise.resolve(1), Promise.resolve(2)])
.then(([x, y]) => {
    console.log(x, y);
});
```

### æ— æ³•å–æ¶ˆ

Promise ä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚

### æ— æ³•å¾—çŸ¥ pending çŠ¶æ€

å½“å¤„äº pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚



## Promise å‡­å€Ÿä»€ä¹ˆæ¶ˆç­äº†å›è°ƒåœ°ç‹±ï¼Ÿ

Promise åˆ©ç”¨äº†ä¸‰å¤§æŠ€æœ¯æ‰‹æ®µæ¥è§£å†³`å›è°ƒåœ°ç‹±`:

- **å›è°ƒå‡½æ•°å»¶è¿Ÿç»‘å®š**
- **è¿”å›å€¼ç©¿é€**
- **é”™è¯¯å†’æ³¡**

é¦–å…ˆæ¥ä¸¾ä¸ªä¾‹å­:

```js
let readFilePromise = (filename) => {
  fs.readFile(filename, (err, data) => {
    if(err) {
      reject(err);
    }else {
      resolve(data);
    }
  })
}
readFilePromise('1.json').then(data => {
  return readFilePromise('2.json')
});
```

å›è°ƒå‡½æ•°ä¸æ˜¯ç›´æ¥å£°æ˜çš„ï¼Œè€Œæ˜¯åœ¨é€šè¿‡åé¢çš„ then æ–¹æ³•ä¼ å…¥çš„ï¼Œå³å»¶è¿Ÿä¼ å…¥ã€‚è¿™å°±æ˜¯`å›è°ƒå‡½æ•°å»¶è¿Ÿç»‘å®š`ã€‚

ç„¶ååšä»¥ä¸‹å¾®è°ƒ:

```js
let x = readFilePromise('1.json').then(data => {
  return readFilePromise('2.json')//è¿™æ˜¯è¿”å›çš„Promise
});
x.then(/* å†…éƒ¨é€»è¾‘çœç•¥ */)
```

æˆ‘ä»¬ä¼šæ ¹æ® then ä¸­å›è°ƒå‡½æ•°çš„ä¼ å…¥å€¼åˆ›å»ºä¸åŒç±»å‹çš„Promise, ç„¶åæŠŠè¿”å›çš„ Promise ç©¿é€åˆ°å¤–å±‚, ä»¥ä¾›åç»­çš„è°ƒç”¨ã€‚è¿™é‡Œçš„ x æŒ‡çš„å°±æ˜¯å†…éƒ¨è¿”å›çš„ Promiseï¼Œç„¶ååœ¨ x åé¢å¯ä»¥ä¾æ¬¡å®Œæˆé“¾å¼è°ƒç”¨ã€‚

è¿™ä¾¿æ˜¯`è¿”å›å€¼ç©¿é€`çš„æ•ˆæœã€‚

è¿™ä¸¤ç§æŠ€æœ¯ä¸€èµ·ä½œç”¨ä¾¿å¯ä»¥å°†æ·±å±‚çš„åµŒå¥—å›è°ƒå†™æˆä¸‹é¢çš„å½¢å¼:

```js
readFilePromise('1.json').then(data => {
    return readFilePromise('2.json');
}).then(data => {
    return readFilePromise('3.json');
}).then(data => {
    return readFilePromise('4.json');
});
```

è¿™æ ·å°±æ˜¾å¾—æ¸…çˆ½äº†è®¸å¤šï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ›´ç¬¦åˆäººçš„çº¿æ€§æ€ç»´æ¨¡å¼ï¼Œå¼€å‘ä½“éªŒä¹Ÿæ›´å¥½ã€‚

ä¸¤ç§æŠ€æœ¯ç»“åˆäº§ç”Ÿäº†`é“¾å¼è°ƒç”¨`çš„æ•ˆæœã€‚

è¿™è§£å†³çš„æ˜¯å¤šå±‚åµŒå¥—çš„é—®é¢˜ï¼Œé‚£å¦ä¸€ä¸ªé—®é¢˜ï¼Œå³æ¯æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸå`åˆ†åˆ«å¤„ç†æˆåŠŸå’Œå¤±è´¥`çš„æƒ…å†µæ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ

Promise é‡‡ç”¨äº†`é”™è¯¯å†’æ³¡`çš„æ–¹å¼ã€‚å…¶å®å¾ˆç®€å•ç†è§£:

```js
readFilePromise('1.json').then(data => {
    return readFilePromise('2.json');
}).then(data => {
    return readFilePromise('3.json');
}).then(data => {
    return readFilePromise('4.json');
}).catch(err => {
  // xxx
})
```

è¿™æ ·å‰é¢äº§ç”Ÿçš„é”™è¯¯ä¼šä¸€ç›´å‘åä¼ é€’ï¼Œè¢« catch æ¥æ”¶åˆ°ï¼Œå°±ä¸ç”¨é¢‘ç¹åœ°æ£€æŸ¥é”™è¯¯äº†ã€‚

è§£å†³æ•ˆæœï¼š

- å®ç°é“¾å¼è°ƒç”¨ï¼Œè§£å†³å¤šå±‚åµŒå¥—é—®é¢˜
- å®ç°é”™è¯¯å†’æ³¡åä¸€ç«™å¼å¤„ç†ï¼Œè§£å†³æ¯æ¬¡ä»»åŠ¡ä¸­åˆ¤æ–­é”™è¯¯ã€å¢åŠ ä»£ç æ··ä¹±åº¦çš„é—®é¢˜



## ä¸ºä»€ä¹ˆPromiseè¦å¼•å…¥å¾®ä»»åŠ¡ï¼Ÿ

å›åˆ°é—®é¢˜æœ¬èº«ï¼Œå…¶å®å°±æ˜¯å¦‚ä½•å¤„ç†å›è°ƒçš„é—®é¢˜ã€‚æ€»ç»“èµ·æ¥æœ‰ä¸‰ç§æ–¹å¼:

1. ä½¿ç”¨åŒæ­¥å›è°ƒï¼Œç›´åˆ°å¼‚æ­¥ä»»åŠ¡è¿›è¡Œå®Œï¼Œå†è¿›è¡Œåé¢çš„ä»»åŠ¡ã€‚
2. ä½¿ç”¨å¼‚æ­¥å›è°ƒï¼Œå°†å›è°ƒå‡½æ•°æ”¾åœ¨è¿›è¡Œ`å®ä»»åŠ¡é˜Ÿåˆ—`çš„é˜Ÿå°¾ã€‚
3. ä½¿ç”¨å¼‚æ­¥å›è°ƒï¼Œå°†å›è°ƒå‡½æ•°æ”¾åˆ°`å½“å‰å®ä»»åŠ¡ä¸­`çš„æœ€åé¢ã€‚

### ä¼˜åŠ£å¯¹æ¯”

ç¬¬ä¸€ç§æ–¹å¼æ˜¾ç„¶ä¸å¯å–ï¼Œå› ä¸ºåŒæ­¥çš„é—®é¢˜éå¸¸æ˜æ˜¾ï¼Œä¼šè®©æ•´ä¸ªè„šæœ¬é˜»å¡ä½ï¼Œå½“å‰ä»»åŠ¡ç­‰å¾…ï¼Œåé¢çš„ä»»åŠ¡éƒ½æ— æ³•å¾—åˆ°æ‰§è¡Œï¼Œè€Œè¿™éƒ¨åˆ†`ç­‰å¾…çš„æ—¶é—´`æ˜¯å¯ä»¥æ‹¿æ¥å®Œæˆå…¶ä»–äº‹æƒ…çš„ï¼Œå¯¼è‡´ CPU çš„åˆ©ç”¨ç‡éå¸¸ä½ï¼Œè€Œä¸”è¿˜æœ‰å¦å¤–ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯æ— æ³•å®ç°`å»¶è¿Ÿç»‘å®š`çš„æ•ˆæœã€‚

å¦‚æœé‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œé‚£ä¹ˆæ‰§è¡Œå›è°ƒ(resolve/reject)çš„æ—¶æœºåº”è¯¥æ˜¯åœ¨å‰é¢`æ‰€æœ‰çš„å®ä»»åŠ¡`å®Œæˆä¹‹åï¼Œå€˜è‹¥ç°åœ¨çš„ä»»åŠ¡é˜Ÿåˆ—éå¸¸é•¿ï¼Œé‚£ä¹ˆå›è°ƒè¿Ÿè¿Ÿå¾—ä¸åˆ°æ‰§è¡Œï¼Œé€ æˆ`åº”ç”¨å¡é¡¿`ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°æ–¹æ¡ˆçš„é—®é¢˜ï¼Œå¦å¤–ä¹Ÿè€ƒè™‘åˆ°`å»¶è¿Ÿç»‘å®š`çš„éœ€æ±‚ï¼ŒPromise é‡‡å–ç¬¬ä¸‰ç§æ–¹å¼, å³`å¼•å…¥å¾®ä»»åŠ¡`, å³æŠŠ resolve(reject) å›è°ƒçš„æ‰§è¡Œæ”¾åœ¨å½“å‰å®ä»»åŠ¡çš„æœ«å°¾ã€‚

è¿™æ ·ï¼Œåˆ©ç”¨`å¾®ä»»åŠ¡`è§£å†³äº†ä¸¤å¤§ç—›ç‚¹:

- é‡‡ç”¨**å¼‚æ­¥å›è°ƒ**æ›¿ä»£åŒæ­¥å›è°ƒè§£å†³äº†æµªè´¹ CPU æ€§èƒ½çš„é—®é¢˜ã€‚
- æ”¾åˆ°**å½“å‰å®ä»»åŠ¡æœ€å**æ‰§è¡Œï¼Œè§£å†³äº†å›è°ƒæ‰§è¡Œçš„å®æ—¶æ€§é—®é¢˜ã€‚




## é¢è¯•é¢˜ï¼šçº¢ç»¿ç¯é—®é¢˜

é¢˜ç›®ï¼šçº¢ç¯ä¸‰ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ä¸€ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯2ç§’äº®ä¸€æ¬¡ï¼›å¦‚ä½•è®©ä¸‰ä¸ªç¯ä¸æ–­äº¤æ›¿é‡å¤äº®ç¯ï¼Ÿï¼ˆç”¨ Promse å®ç°ï¼‰



### promsieå®ç°

ä¸‰ä¸ªäº®ç¯å‡½æ•°å·²ç»å­˜åœ¨ï¼š

```js
function red(){
    console.log('red');
}
function green(){
    console.log('green');
}
function yellow(){
    console.log('yellow');
}
```

**æ€è·¯**

é¦–å…ˆè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨æ¥æ”¶äº®ç¯å’Œäº®ç¯çš„æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå®šæ—¶å™¨å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œäº®ç¯é¢œè‰²å’Œäº®ç¯æ—¶é—´ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªPromiseï¼Œç”±äºPromiseæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œåªæœ‰å‘ç”ŸçŠ¶æ€å“åº”çš„æ—¶å€™ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œ(è¿™æ ·å°±å®ç°äº†ä¸‰ä¸ªç¯æœ‰é¡ºåºçš„æ‰§è¡Œ)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆåœ¨Promiseä¸­å°†é¢œè‰²æ‰“å°å‡ºæ¥ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå®šæ—¶å™¨è®¾ç½®æ—¶é—´å»¶æ—¶ï¼Œå»¶æ—¶ç›¸å½“äºå°±æ˜¯äº®ç¯çš„æ—¶é—´ï¼Œå› ä¸ºæˆ‘ä»¬äº®ç¯äº†ï¼Œç„¶åå»¶æ—¶ï¼Œå°±ä¼šé€ æˆä¸€ç§ç¯åœ¨è¿™æ®µæ—¶é—´ä¸€ç›´äº®ç€çš„æ•ˆæœ

```js
var light = function(timmer, cb){
    return new Promise(function(resolve, reject) {
        setTimeout(function() {
            cb();
            resolve();
        }, timmer);
    });
};
```

ä»ä¸Šé¢æ“ä½œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¿”å›äº†ä¸€ä¸ªPromiseï¼Œäº®ç¯åå®šæ—¶è¿›è¡Œresolve(),æ‰èƒ½è¿›å…¥åˆ°ä¸‹ä¸€æ­¥éª¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»å®Œæˆäº†äº®ç¯å’Œå»¶æ—¶ï¼Œç°åœ¨æˆ‘ä»¬å¯¹ä¸‰ä¸ªé¢œè‰²çš„ç¯é…åˆ`then`è¿›è¡Œä¸‰ä¸ªç¯çš„é¡ºåºäº®ç¯

```js
Promise.resolve().then(function(){
        return light(3000, red);
    }).then(function(){
        return light(2000, green);
    }).then(function(){
        return light(1000, yellow);
    })
```

æœ€åæˆ‘ä»¬ç»™ä»–è¿›è¡Œå¾ªç¯æ˜¾ç¤ºï¼Œé€šè¿‡`é€’å½’`å®ç°ï¼š

```js
var step = function() {
    Promise.resolve().then(function(){
        return light(3000, red);
    }).then(function(){
        return light(2000, green);
    }).then(function(){
        return light(1000, yellow);
    }).then(function(){
        step();
    });
}

step();
```





**æ•´ä½“ä»£ç å®ç°å¦‚ä¸‹**

åˆ©ç”¨ then å’Œ **é€’å½’** å®ç°ï¼š

```js
function red(){
    console.log('red');
}
function green(){
    console.log('green');
}
function yellow(){
    console.log('yellow');
}

var light = function(timmer, cb){
    return new Promise(function(resolve, reject) {
        setTimeout(function() {
            cb();
            resolve();
        }, timmer);
    });
};

var step = function() {
    Promise.resolve().then(function(){
        return light(3000, red);
    }).then(function(){
        return light(2000, green);
    }).then(function(){
        return light(1000, yellow);
    }).then(function(){
        step();
    });
}

step();
```



### asyncï¼Œawaitå®ç°

```js
async function timer(color,delay){
  return new Promise((res,rej)=>{
      console.log(color)
      setTimeout(() => {
          res()
      }, delay);
  })
}

async function light(){
  await timer('green',1000)
  await timer('yellow',2000)
  await timer('red',3000)
  await light()

}
light()
```



## é¢è¯•é¢˜ï¼šä½¿ç”¨Promiseå®ç°æ¯éš”1ç§’è¾“å‡º1,2,3

### setTimeoutå®ç°

```js
let arr = [1, 2, 3]
function timeout(count = 0){
  if(count === arr.length) return;
  setTimeout(() => {
    console.log(arr[count]);
    timeout(++count);
  }, 1000);
}
timeout()
```



### asyncå®ç°

```js
let arr = [1,2,3]
async function timer(){
  for(let i = 0; i < arr.length; i++){
    console.log(await _promise(arr[i]))
  }
}
function _promise(data){
  return new Promise((resolve,reject) => {
    setTimeout(() => {
      resolve(data);
    }, 1000);
  })
}
timer();
```



### promiseå®ç°

```js
let arr = [1, 2, 3]
Promise.resolve()
  .then(() => {
    return new Promise(resolve => { 
      setTimeout(() => { 
        console.log(arr[0]); 
        resolve() 
      }, 1000) 
    })
  })
  .then(() => {
    return new Promise(resolve => { 
      setTimeout(() => { 
        console.log(arr[1]); 
        resolve() 
      }, 1000) 
    })
  })
  .then(() => {
    return new Promise(resolve => { 
      setTimeout(() => { 
        console.log(arr[2]); 
        resolve() 
      }, 1000) 
    })
  })
```



**ä½¿ç”¨reduceå®ç°**

```js
let arr = [1, 2, 3]
arr.reduce((p,x) => {
  return p.then(() => {
    return new Promise(resolve => {
      setTimeout(() => {
        // console.log(x);
        // resolve();
        resolve(console.log(x));
      },1000)
    })
  })
},Promise.resolve())
```



**foreachå®ç°**

```js
let arr = [1, 2, 3]
let p = Promise.resolve();
arr.forEach(item => {
    p = p.then(() => {
      return new Promise(resolve => {
        setTimeout(() => {
          console.log(item);
          resolve();
        }, 1000);
      })
    })
})
```



## ä»£ç è¾“å‡ºé¢˜ï¼šthenä¸­å­˜åœ¨promise.then

```js
new Promise((resolve, reject) => {
  console.log("å¤–éƒ¨promise");
  resolve();
})
  .then(() => {
    console.log("å¤–éƒ¨ç¬¬ä¸€ä¸ªthen");
    new Promise((resolve, reject) => {
      console.log("å†…éƒ¨promise");
      resolve();
    })
      .then(() => {
        console.log("å†…éƒ¨ç¬¬ä¸€ä¸ªthen");
      })
      .then(() => {
        console.log("å†…éƒ¨ç¬¬äºŒä¸ªthen");
      });
  })
  .then(() => {
    console.log("å¤–éƒ¨ç¬¬äºŒä¸ªthen");
  });
```

è¾“å‡ºç»“æœï¼š

```js
å¤–éƒ¨promise
å¤–éƒ¨ç¬¬ä¸€ä¸ªthen
å†…éƒ¨promise
å†…éƒ¨ç¬¬ä¸€ä¸ªthen
å¤–éƒ¨ç¬¬äºŒä¸ªthen
å†…éƒ¨ç¬¬äºŒä¸ªthen
```

**è§£é‡Š**

thenå¹¶ä¸æ˜¯ä¸€ä¸‹å°†å…¨éƒ¨çš„thenæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè€Œæ˜¯å½“ç¬¬ä¸€ä¸ªthenæœ‰äº†è¿”å›å€¼åå†å°†ç¬¬äºŒä¸ªthenæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

**å¤–éƒ¨çš„ç¬¬äºŒä¸ª then çš„æ³¨å†Œï¼Œéœ€è¦ç­‰å¾… å¤–éƒ¨çš„ç¬¬ä¸€ä¸ª then çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆ**

- å½“æ‰§è¡Œå†…éƒ¨çš„ new Promise çš„æ—¶å€™ï¼Œç„¶åç¢°åˆ° resolveï¼Œresolve æ‰§è¡Œå®Œæˆï¼Œä»£è¡¨æ­¤æ—¶çš„è¯¥ Promise çŠ¶æ€å·²ç»æ‰­è½¬ï¼Œä¹‹åå¼€å§‹å†…éƒ¨çš„ç¬¬ä¸€ä¸ª .then çš„å¾®ä»»åŠ¡çš„æ³¨å†Œï¼Œæ­¤æ—¶åŒæ­¥æ‰§è¡Œå®Œæˆã€‚

- è¿™ä¸ªæ—¶å€™ï¼Œå¤–éƒ¨çš„ç¬¬ä¸€ä¸ª then çš„åŒæ­¥æ“ä½œå·²ç»å®Œæˆäº†ï¼Œç„¶åå¼€å§‹æ³¨å†Œå¤–éƒ¨çš„ç¬¬äºŒä¸ª thenï¼Œæ­¤æ—¶å¤–éƒ¨çš„åŒæ­¥ä»»åŠ¡ä¹Ÿéƒ½å®Œæˆäº†ã€‚

- åŒæ­¥æ“ä½œå®Œæˆä¹‹åï¼Œé‚£ä¹ˆå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œæˆ‘ä»¬å‘ç° å†…éƒ¨çš„ç¬¬ä¸€ä¸ª then æ˜¯ä¼˜å…ˆäºå¤–éƒ¨çš„ç¬¬äºŒä¸ª then çš„æ³¨å†Œï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œå®Œå†…éƒ¨çš„ç¬¬ä¸€ä¸ª then ä¹‹åï¼Œç„¶åæ³¨å†Œå†…éƒ¨çš„ç¬¬äºŒä¸ª then ï¼Œç„¶åæ‰§è¡Œå¤–éƒ¨çš„ç¬¬äºŒä¸ª then ,ç„¶åå†æ‰§è¡Œå†…éƒ¨çš„ç¬¬äºŒä¸ª thenã€‚



## Promise/A+ å’Œ webkit çš„ Promise çš„å®ç°å·®å¼‚

```js
Promise.resolve().then(() => {
    console.log(0);
    return Promise.resolve(4);
}).then((res) => {
    console.log(res)
})

Promise.resolve().then(() => {
    console.log(1);
}).then(() => {
    console.log(2);
}).then(() => {
    console.log(3);
}).then(() => {
    console.log(5);
}).then(() =>{
    console.log(6);
})
```

// è¾“å‡ºï¼š0 1 2 3 4 5 6

è¿™é‡Œ 4 çš„ä½ç½®æ˜¾ç¤ºï¼Œthen å†…éƒ¨åœ¨å¤„ç† `return Promise.resolve(4)` æ–¹æ³•çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½æ˜¯äº§ç”Ÿäº†ç±»ä¼¼ 2 æ¬¡å¾®ä»»åŠ¡çš„ç°è±¡ï¼›



> Jså¼•æ“ä¸ºäº†è®©microtaskå°½å¿«çš„è¾“å‡ºï¼Œåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œè¿ç»­çš„å¤šä¸ªthen(3ä¸ª)å¦‚æœæ²¡æœ‰rejectæˆ–è€…resolveä¼šäº¤æ›¿æ‰§è¡Œthenè€Œä¸è‡³äºè®©ä¸€ä¸ªå µå¤ªä¹…å®Œæˆç”¨æˆ·æ— å“åº”ï¼Œä¸å•å•v8è¿™æ ·å…¶ä»–å¼•æ“ä¹Ÿæ˜¯è¿™æ ·ï¼Œå› ä¸ºå…¶å®promuseå†…éƒ¨çŠ¶æ€å·²ç»ç»“æŸäº†ã€‚è¿™å—åœ¨v8æºç é‡Œæœ‰å®Œæ•´çš„ä½“ç°



Promiseæœ€æ–°è§„èŒƒï¼ŒonFulfilledä¸­è¿”å›ä¸€ä¸ªPromiseï¼Œä¼šç”¨å¾®ä»»åŠ¡æŠŠPromiseå†åŒ…è£…ä¸€å±‚



è¿™é‡Œè¯´æ˜ `return Promise.resolve(4)` ä¸ `new Promise(resolve => { reolve(4) })` çš„æ–¹å¼å¹¶æ— å·®å¼‚ï¼›

`return Promise.reolve(4)` ä¸

```js
return new Promise(resolve => {
    resolve(4)
  })
  .then(res => {
    return res
  })
```

äº§ç”Ÿçš„æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œ



**å‚è€ƒæ–‡ç« **

[ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Promise](https://github.com/mqyqingfeng/Blog/issues/98)

[(2.4wå­—,å»ºè®®æ”¶è—)ğŸ˜‡åŸç”ŸJSçµé­‚ä¹‹é—®(ä¸‹), å†²åˆºğŸš€è¿›é˜¶æœ€åä¸€å…¬é‡Œ(é™„ä¸ªäººæˆé•¿ç»éªŒåˆ†äº«)](https://juejin.cn/post/6844904004007247880#heading-43)

[ã€å»ºè®®æ˜Ÿæ˜Ÿã€‘è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•(1.1wå­—ç”¨å¿ƒæ•´ç†)](https://juejin.cn/post/6844904077537574919#heading-56)